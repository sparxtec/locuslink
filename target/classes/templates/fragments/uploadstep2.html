<html  xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Upload Docs</title>

    <!-- StyleSheets - ORDER IS IMPORTANT -->
    <link href="css/de-upload-styles.css" rel="stylesheet">
    
    <script>		
		var stepper1 = null;		
		Dropzone.autoDiscover = false;		
		$('#tracedropzone').dropzone({
			
			   headers:{   'X-CSRFToken' : '{{ csrf_token }}' },				
			   acceptedFiles: '.csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',			 			 		
			   maxThumbnailFilesize: '15',
			   dictInvalidFileType: "Incorrect File type, please upload only xls files",			   
			    
	 		   init: function() {
	 		     this.on("addedfile", 
	 		    	function(file) {	    	
	 		      });
	 		     
	 		     this.on("success", 
	 		    	function(file) {
	 		    	  $(".dz-success-mark svg").css("background", "green");
	 		    	  $(".dz-error-mark").css("display", "none");	 		    	 	 		    	  
	 		    	  document.getElementById("continueUploadPage3").disabled = false;	 		    		    
	 		      }); 		     		  
	 		
	 	     	this.on("error", 
	 		    	function(file) {
	 	     		  $(".dz-error-mark svg").css("background", "red");
	 	     		  $(".dz-success-mark").css("display", "none");	 	     		  	 	     		 
	 		      }); 		
	 	     	
	 	     	this.on("removedfile", 
	 	     		function(file) {
	 	         		var myData = {version:"1.0", protocol:"json", clientId:"trace"};
	 	               	var innerData = {};
	 	        		innerData["fileName"] = file.name;
	 	        		innerData["userName"] = "TSpecte";
	 	        		myData["data"] = innerData;

	 	        		submitFormAjaxJSON("deleteFileUpload", myData, "deleteFileUploadResponse");
	 	        		if (this.files[0] == null) {

			 		   		document.getElementById("continueUploadPage3").disabled = true;
			 		    }
	 	     		});		   
	 		   }
	 		
	 		}); 
	         	
		$(document).ready(function() {	
			
			window.addEventListener("dragover",function(e){
				  e = e || event;
				  e.preventDefault();
				},false);
				window.addEventListener("drop",function(e){
				  e = e || event;
				  e.preventDefault();
				},false);
			
			// C.Sparks 2-19-2020				
			document.getElementById("continueUploadPage3").disabled = true;
			
			$('#previousGoToUploadPage1').click(function() {		
				showSpinner();			
				submitFormAjaxHTML('initUpload', $( "#dashboardFormDTO" ).serialize(), "initCommonResponse");
			});
			
	
			// C.Sparks - 2-19-2020 New Routine, both buttons on the UI for now
			$('#continueUploadPage3').click(function() {													
				showSpinner();	
				
/* 	         	var myData = {version:"1.0", protocol:"json", clientId:"trace"};
 	            var innerData = {};	  */
 	            
/*  	            innerData["poNumber"] = $('#poNumber').val();
	        	innerData["woNumber"] = $('#woNumber').val();
	        	innerData["projectNum"] = $('#projectNum').val() */
//	        	innerData["selectedDocType"] = $('#selectedDocType').val() 
/* 	        	innerData["itemNumber"] = $('#itemNumber').val() 
	        	innerData["selectedContractorType"] = $('#selectedContractorType').val()  */
	        	  	
/*  	        	myData["data"] = innerData; 
	        	
        		submitFormAjaxJSON("loadQDocReqLine_2", myData, "processTableData");
        			 */	
        			 
				showSpinner();			
				submitFormAjaxHTML('initUploadStep3', $( "#dashboardFormDTO" ).serialize(), "initCommonResponse");
	 
        			 
			});
			
				
			$('#continueGoToMRCUpload').click(function() {													
				showSpinner();			
				submitFormAjaxHTML('initMRCFileDrop', $( "#docUploadFormDTO" ).serialize(), "commonResponse"); 
			});

		    stepper1 = new Stepper($('.bs-stepper')[0], {
		        linear: true
		     }); 

		    stepper1.to(2);
	
		    $(".dz-message").html('<button type="button" class="button button--secondary mb-4" style="min-width: 20rem;">Click to browse files</button><p>Each file must be less than 20MB and a ".xls,.xlsx" file.</p>');		    		    	
			hideSpinner();				    
		    $('#uploadDocs1_Id').addClass("is-current");
		    									
		});
		
/* 		function deleteRow(el) {
			if ($(el).parent().parent().is("tr")){
				$(el).parent().parent().remove();
			} else {
				$(el).parent().parent().parent().parent().parent().prev().remove();
				$(el).parent().parent().parent().parent().parent().remove();
			}
		} */
			
		function initCommonResponse(returnData) {	
			hideSpinner();
			$('#mainBody').html( returnData); 	 
		}
		
		function commonResponse(returnData) {		
			hideSpinner();
			$('#mainBody').html( returnData); 	 
		}
		
/* 		function showDataTable(data) {							
			hideSpinner();
			$('#mainBody').html(data); 
		} */
		
		// 3-18-2020
		//function processTableData(data, poNumber, woNumber, ehubPOLineString, projectNum) {	
/* 		function processTableData(returnData) {					             	
    	    $.ajax({
   	           type: "POST",
   	           url: "initDocUploadStep3",               
   	           data: JSON.stringify(returnData),
   	           contentType: 'application/json',
   	           success: showDataTable,         
  				   error: ajaxResponseError, 
			   complete: function() { 
					hideSpinner();
	           }
    	     });  	
		} */

	</script>

  </head>
  
  
  <body>

     <section class="de-component h-100">
         <div class="de-component__container">
             <header class="de-component-header mb-0">
                 <h2 class="de-component-header__title">Upload Docs</h2>
             </header>

             <div id="stepper1" class="bs-stepper">
                 <div class="bs-stepper-header m-auto bs-stepper-custom-width" role="tablist">
                     <div class="step" data-target="#step1">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger1" aria-controls="test-l-1" aria-selected="true">
                             <span class="bs-stepper-circle">1</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                     <div class="line"></div>
                     <div class="step active" data-target="#step2">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger2" aria-controls="test-l-2" aria-selected="false">
                             <span class="bs-stepper-circle">2</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                     <div class="line"></div>
                     <div class="step" data-target="#step3">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger3" aria-controls="test-l-3" aria-selected="false">
                             <span class="bs-stepper-circle">3</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                 </div>    
                 
                 
                             
                 <div class="bs-stepper-content">
                 
                     <div id="step1" role="tabpanel" class="content" aria-labelledby="stepper1trigger1">
                     </div>
                     
                     <div id="step2" role="tabpanel" class="content active" aria-labelledby="stepper1trigger2">
                         <div class="form-group text-center bs-stepper-custom-width m-auto">
                            <label class="d-inline-block mb-3"  th:if="${selectedDocType == 'PO' or selectedDocType == 'PROJECT_NUMBER'}"><span th:if="${selectedDocType == 'PROJECT_NUMBER'}"> Project Number # : <span th:text="${projectNum}"></span></span> | P.O. #: <span th:text="${poNumber}"></span><span th:if="${woNumber != ''}"> | W.O. # : <span th:text="${woNumber}"></span></span>
                             </label>
                                
                            <label class="d-inline-block mb-3" >Document Type : 
                                <span th:text="${dashboardFormDTO.selectedDocType}"> </span>
                            </label>
                               
							<form id="tracedropzone" name="tracedropzone"							
								action="/portal/processCsvFileUpload" class="dropzone dz-clickable"enctype="multipart/form-data" method="POST">								
								
								<!-- CSRF token -->
			 					<input type="hidden" th:name="${_csrf.parameterName}"   th:value="${_csrf.token}"/>
			 
								<div class="dz-default dz-message">
									<span>Files must be less than 15MB and a '.xls' file</span>
								</div>
							</form>
	 					 </div>
                         <div class="py-4 text-center px-0 d-flex justify-content-between d-sm-block">
                         
                             <button type="button" id="previousGoToUploadPage1" class="button button--previous" onclick="">Previous</button>
                            <button type="button" id="continueUploadPage3" class="button button--continue ml-3" onclick="" disabled>Continue</button>           
                                          
                         </div>
                     </div>
                     

 					 <div id="step3" role="tabpanel" class="content" aria-labelledby="stepper1trigger3">
                     </div>
                     
                     <div id="step4" role="tabpanel" class="content" aria-labelledby="stepper1trigger4">
                     </div> 
     
                     
                 </div>
             </div>

         </div>
     </section>

	</body>
  
</html>