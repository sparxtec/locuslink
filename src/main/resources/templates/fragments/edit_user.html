<!doctype html>
<html  xmlns:th="http://www.thymeleaf.org">
   	<head>
      	<meta charset="utf-8">
      	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10"/>
      	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      	<meta name="description" content="">
      	<meta name="author" content="">
      	<link rel="icon" href="favicon.ico">
      	<title>Edit Users</title>

    	<link href="css/de-profile-styles.css" rel="stylesheet">
		    
      	<script>	
        	$(document).ready(function() {	
         		hideSpinner();
         		         		
         		if( $('#editUserDataTable').length){
         			var table = $('#editUserDataTable').DataTable( {
                	retrieve: true,
         	 		searchHighlight: false,
                 	responsive: true,		        
                 	"paging":   true,	
                 	scrollCollapse: true,
                 	scrollY: 'calc(100vh - 35rem)',	
                 	order: [1, 'asc' ],		        
        //     		colReorder: true,		        
         
         	    	ajax: {
               		    url: 'getAllUser',
               		 	type: 'POST',
                		contentType: 'application/json',
                		data: function ( data ) {
                			showSpinner();
                			//var pageCode=$('#pageListCode').val();
                			var myData = {version:"1.0", clientId:"gim"};
                			var innerData = {};
                			//innerData["designId"] = "123";
                			//innerData["pageCode"] = pageCode;
                			myData["data"] = innerData;	        				        		
                    		return JSON.stringify( myData );
         	        },
         	        "dataSrc": function (json) {
         	        	userList = json.data.userList;	
         	        	console.log(userList);
         	        	hideSpinner();	// C.Sparks 1-19-19			    
         	        	return userList;						    
         	         }					       
            		},  
         
                 columns: [	 
                 	
                     { data: "userLocusLinkPkId" },
                     { data: "userTypeCode" },
                     { data: "loginName" },
                     { data: "firstName" },
                     { data: "lastNameBusName" },
              /*        { data: "activeFlag" } , */
                      { data: "activeFlag" ,
                     	"render": function(data, type, row, meta){	
                     		if('Y' == row['activeFlag']){
                     			
                     			data = "<div class='d-flex'><a href='#' id='deactivateUser_"+row.lanId+"_"+row.activeFlag+"' onclick='deactivateRow(this)' class='button button--text'>Deactivate </a> <a href='#'  onclick='deleteRow(this,event)' id='deleteUser_"+row.lanId+"' class='button button--text ml-3'>Delete</a></div>"
                             }
                     		else
                     			{
                     			data = "<div class='d-flex'><a href='#' id='deactivateUser_"+row.lanId+"_"+row.activeFlag+"' onclick='deactivateRow(this)' class='button button--text'>Activate </a> <a href='#'  onclick='deleteRow(this,event)' id='deleteUser_"+row.lanId+"' class='button button--text ml-3'>Delete</a></div>"
                     			}
                             return data;
                       }}, 
                          
                          
                	],
                	
                	"createdRow": function( row, data, dataIndex ) {
                		//console.log(data.itemNumErrorFlag);
                	
                	    if ( data.activeFlag == "N" ) {
                	    	 $(row).addClass('deactivated');
                	    	 // $('tr', row).eq(9).addClass("checked"); 
                	    }    
                	   
                	  },
                	  //dom: '<"datatable-toolbar border border-bottom-0 text-secondary d-flex justify-content-between align-items-center py-2 px-3" <"datatable-toolbar-group" <"#addbtn">> <"datatable-toolbar-group" f> ><t><"datatable-pagination d-flex flex-row justify-content-center justify-content-md-between align-items-center mt-2" <"datatable-pagination-group d-none d-md-block" l><"datatable-pagination-group" p><"datatable-pagination-group d-none d-md-block" i>>',
                	  dom: '<t><"datatable-pagination d-flex flex-row justify-content-center justify-content-md-between align-items-center mt-2" <"datatable-pagination-group d-none d-md-block" l><"datatable-pagination-group" p><"datatable-pagination-group d-none d-md-block" i>>',
                	  
            		
             });
         }
            
     		// SEARCH FILTER
     		$('#editUserDataTable_filter input').keyup(function(){
     			table.search($(this).val()).draw() ;
     		});
         			
         	$("#addbtn").html('<button class="button button--secondary-reversed w-auto" type="button"  data-toggle="modal" data-target="#addUserModal" id="addEditUserlink"> Add User</button>');
         	
         	$(".dataTables_length select").addClass("form-control");
         
       		 $('#addEditUserlink').click(function() {
       			$('#role option[value="MRC"]').prop('selected', true);
       			$("#addUserModal").find('input[type="text"],textarea').val('');
       			 $('#addUserMessage').text("");
       		 });
       		  
       		 $(".btn-back").on('click', function(){
					showSpinner();
					$('#mainBody').load("initProfilePage", function () {
					  	hideSpinner();
					});
			 });				
       	 });       
         
         function initCommonResponse(returnData) {	
         	hideSpinner();
         	$('#mainBody').html( returnData); 
         	 
         }
         function deactivateRow(el) {
         	var $this = $(this);
         	
         	var id= $(el).attr("id");
         	console.log(id);
         	var tokens= id.split("_");	
         	 var lanId = tokens[1];
         	 if(tokens[0]==="deactivateUser") {

         		 var activeFlag=tokens[2];
         		 console.log(activeFlag);
             		  $.post("deActivateUser", { 'lanId': (lanId), 'activeFlag': (activeFlag)},function(resp){             	
             			  console.log("active staus after response"+resp);
             			  var  newid="deactivateUser_"+lanId+"_"+resp;
             			  console.log(newid);
             			 $('#editUserDataTable').DataTable().ajax.reload();
             				
         	     }); 
             	 }	         	
         	
         }
         
         function deleteRow(el,event) {
         	 event.stopImmediatePropagation();
         	var id= $(el).attr("id");
         	console.log(id);
         	var tokens= id.split("_");	
         	 var lanId = tokens[1];
         	 if(tokens[0]==="deleteUser") {
         		jQuery('#deleteUserModal').modal();
         	
         	$('#confirmDeleteBtn').off().on('click', function(){
         
         		 $.post("deleteUserProfile", { 'lanId': (lanId)},function(){
         			 if ($(el).parents("tr").hasClass("child")){
         				 row = $(el).parents("tr.child").prevAll(".parent");
         					$(el).parents("tr.child").prev().remove();
         					$(el).parents("tr.child").remove();	
         					
         				} else {
         					 row =$(el).parents("tr");
         					$(el).parents("tr").remove();
         				} 
         			 
         			 $('#editUserDataTable').DataTable().row( row ).remove().draw();                  
             			
         	     	}); 
         		
         		});
         	 }
         }	
         
      </script>	
   </head>
   
   
   <body>
		
	<form id="dashboardFormDTO" class="bg-light" name="dashboardFormDTO" th:object="${dashboardFormDTO}"  method="post">
		<section id="manage_1_mainBody" class="de-component de-component--gray">
			<div class="de-component__container">

                    <nav aria-label="breadcrumb">
                       <ol class="breadcrumb position-absolute">
                          <li class="breadcrumb-item"><a href="#" class="uppercasebtn btn-back"><i class="fas fa-chevron-left"></i> Return to Dashboard</a></li>
                       </ol>
                    </nav>

			   	<header class="de-component-header">
			    	<h2 class="de-component-header__title">Manage Users</h2>
				</header>
				
                    
				 <div class="datatable-toolbar border border-bottom-0 text-secondary d-flex justify-content-between align-items-center py-2 px-3">
				 	<div class="datatable-toolbar-group">
				 		<div id="addbtn">
				 			<button class="button button--secondary-reversed w-auto" type="button" data-toggle="modal" data-target="#addUserModal" id="addEditUserlink"> Add User</button>
				 		</div>
				 	</div>
				 	<div class="datatable-toolbar-group">
				 		<div id="editUserDataTable_filter" class="dataTables_filter">
				 			<label class="d-flex align-items-center">Search: <input type="search" class="form-control w-auto" placeholder="" aria-controls="editUserDataTable"></label>
				 		</div>
				 	</div>
				 </div>	                     
                    

                  <!-- <table id="materialManagement" class="display w-100 bg-white border border-top-0"></table> -->
                  <div id="editUserListHeaderId">
                     <table id="editUserDataTable" class="bg-white border border-top-0">
                        <thead class="thead-light">
                           <tr>
                              <th scope="col">Id</th>
                              <th scope="col">User Type</th>
                              <th scope="col">Login Id</th>
                              <th scope="col">First Name</th>
                              <th scope="col">Last NAme</th>
                      <!--         <th scope="col">Active</th> -->
                              <th scope="col">Action</th>
                           </tr>
                        </thead>
                     </table>
                  </div>		                     
				
			</div>
		</section>


       </form>
         
         
         
         
         <div id="editaddUserModal" class="modal" tabindex="-1" role="dialog">
         </div>
         
         <div th:replace="fragments/add_user :: addUser"></div>
         
         <div id="deleteUserModal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
               <div class="modal-content">
                  <div class="modal-header border-0">
                     <h5 class="modal-title">Delete User</h5>
                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                  </div>
                  <div class="modal-body">
                     <p>This will delete the user and associated information. Do you still want to delete?</p>
                  </div>
                  <div class="modal-footer">
                     <button type="button" class="button button--text" data-dismiss="modal">Cancel</button>
                     <button type="button" id="confirmDeleteBtn" class="button button-primary ml-3" data-dismiss="modal">Confirm</button>
                  </div>
               </div>
            </div>
         </div>


   </body>
</html>