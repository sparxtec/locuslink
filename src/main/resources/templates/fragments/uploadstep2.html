<html  xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>UI Testing Harness - Upload Docs</title>

    <!-- StyleSheets - ORDER IS IMPORTANT -->
    <link href="css/de-upload-styles.css" rel="stylesheet">
    
    <script>		
		var stepper1 = null;		
		Dropzone.autoDiscover = false;		
		$('#tracedropzone').dropzone({
			
	 		   init: function() {
	 		     this.on("addedfile", 
	 		    	function(file) {	    	
	 		      });
	 		     
	 		     this.on("success", 
	 		    	function(file) {
	 		    		// CS 2-19-2020
	 		    		document.getElementById("continueGoToPage3_NEW").disabled = false;	 		    		    
	 		      }); 		     		  
	 		
	 	     	this.on("error", 
	 		    	function(file) {	    	
	 		      }); 		
	 	     	
	 	     	this.on("removedfile", 
	 	     		function(file) {
	 	         		var myData = {version:"1.0", protocol:"json", clientId:"trace"};
	 	               	var innerData = {};
	 	        		innerData["fileName"] = file.name;
	 	        		innerData["userName"] = "TSpecte";
	 	        		myData["data"] = innerData;

	 	        		submitFormAjaxJSON("deleteFileUpload", myData, "deleteFileUploadResponse");
	 	        		if (this.files[0] == null) {
			 		    	
			 		    	// C.Sparks 2-19-2020
			 		   		document.getElementById("continueGoToPage3_NEW").disabled = true;
			 		    }
	 	     		});		   
	 		   }
	 		
	 		}); 
	         	
		$(document).ready(function() {	
			
			window.addEventListener("dragover",function(e){
				  e = e || event;
				  e.preventDefault();
				},false);
				window.addEventListener("drop",function(e){
				  e = e || event;
				  e.preventDefault();
				},false);
			
			// C.Sparks 2-19-2020				
			document.getElementById("continueGoToPage3_NEW").disabled = true;
			
			$('#previousGoToPage1').click(function() {		
				showSpinner();			
				submitFormAjaxHTML('initDocUploadStep1', $("#docUploadFormDTO").serialize(), "commonResponse");
			});
			
	
			$('#continueGoToPage3_NEW').click(function() {													
				showSpinner();	
				
	         	var myData = {version:"1.0", protocol:"json", clientId:"trace"};
 	            var innerData = {};	        	
 	            innerData["poNumber"] = $('#poNumber').val();
	        	innerData["woNumber"] = $('#woNumber').val();
	        	innerData["projectNum"] = $('#projectNum').val()
	        	innerData["selectedDocType"] = $('#selectedDocType').val() 
	        	innerData["itemNumber"] = $('#itemNumber').val() 
	        	 innerData["selectedContractorType"] = $('#selectedContractorType').val() 
	        	  	
 	        	myData["data"] = innerData; 
	        	
        		submitFormAjaxJSON("loadQDocReqLine_2", myData, "processTableData");
        						
			});
			
				
			$('#continueGoToMRCUpload').click(function() {													
				showSpinner();			
				submitFormAjaxHTML('initMRCFileDrop', $( "#docUploadFormDTO" ).serialize(), "commonResponse"); 
			});

		     stepper1 = new Stepper($('.bs-stepper')[0], {
		        linear: true
		      }); 

		   stepper1.to(2);
	
		    $(".dz-message").html('<button type="button" class="button button--secondary mb-4" style="min-width: 20rem;">Click to browse files</button><p>Each file must be less than 100MB and a ".pdf" file.</p>');		    		    	
			hideSpinner();				    
		    $('#uploadDocs1_Id').addClass("is-current");
		    									
		});
		
		function deleteRow(el) {
			if ($(el).parent().parent().is("tr")){
				$(el).parent().parent().remove();
			} else {
				$(el).parent().parent().parent().parent().parent().prev().remove();
				$(el).parent().parent().parent().parent().parent().remove();
			}
		}
			
		function initCommonResponse(returnData) {	
			hideSpinner();
			$('#mainBody').html( returnData); 	 
		}
		
		function commonResponse(returnData) {		
			hideSpinner();
			$('#mainBody').html( returnData); 	 
		}
		
		function showDataTable(data) {							
			hideSpinner();
			$('#mainBody').html(data); 
		}
		
		// 3-18-2020
		//function processTableData(data, poNumber, woNumber, ehubPOLineString, projectNum) {	
		function processTableData(returnData) {					             	
    	    $.ajax({
   	           type: "POST",
   	           url: "initDocUploadStep3",               
   	           data: JSON.stringify(returnData),
   	           contentType: 'application/json',
   	           success: showDataTable,         
  				   error: ajaxResponseError, 
			   complete: function() { 
					hideSpinner();
	           }
    	     });  	
		}

	</script>

  </head>
  
  
  <body>

	 <!-- CS 5-14-2020 -->
	 <input type="hidden" id="itemNumber"   name="itemNumber"  th:value="${itemNumber}">
	 <input type="hidden" id="selectedDocType" name="selectedDocType"  th:value="${selectedDocType}">			
			 	       						
     <input type="hidden" id="woNumber" name="woNumber" th:value="${woNumber}">
     <input type="hidden" id="poNumber" name="poNumber" th:value="${poNumber}">  
     <input type="hidden" id="purchaseOrderNumber"   name="purchaseOrderNumber" th:value="${purchaseOrderNumber}"> 
         	
<!-- 	 <input type="hidden" id="fileName"  name="fileName" th:value="${docUploadFormDTO.getFileName()}"> -->
	 
	 <input type="hidden" id="ehubPOLineString"  name="ehubPOLineString" th:value="${ehubPOLineString}">
	 <input type="hidden" id="projectNum" name="projectNum" th:value="${projectNum}">

     <section class="de-component h-100">
         <div class="de-component__container">
             <header class="de-component-header mb-0">
                 <h2 class="de-component-header__title">Upload Docs</h2>
             </header>

             <div id="stepper1" class="bs-stepper">
                 <div class="bs-stepper-header m-auto bs-stepper-custom-width" role="tablist">
                     <div class="step" data-target="#step1">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger1" aria-controls="test-l-1" aria-selected="true">
                             <span class="bs-stepper-circle">1</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                     <div class="line"></div>
                     <div class="step active" data-target="#step2">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger2" aria-controls="test-l-2" aria-selected="false">
                             <span class="bs-stepper-circle">2</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                     <div class="line"></div>
                     <div class="step" data-target="#step3">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger3" aria-controls="test-l-3" aria-selected="false">
                             <span class="bs-stepper-circle">3</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>
                     <div class="step d-none" data-target="#step4">
                         <button type="button" class="btn btn-link step-trigger" role="tab" id="stepper1trigger4" aria-controls="test-l-4" aria-selected="false">
                             <span class="bs-stepper-circle">4</span>
                             <span class="bs-stepper-label"></span>
                         </button>
                     </div>

                 </div>    
                 
                 
                 
                 
                             
                 <div class="bs-stepper-content">
                 
                     <div id="step1" role="tabpanel" class="content" aria-labelledby="stepper1trigger1">
                         <div class="form-group d-flex flex-column justify-content-center align-items-center bs-stepper-custom-width m-auto text-center">
                             <label class="d-inline-block mb-3" for="purchaseOrderNumber">Please enter a purchase order number to associate your file uploads with.</label>
                              <div id="showOnlyWhenDBErrors" class="alert alert-danger" role="alert"  style="display:none">
								<strong>Invalid PO Number:</strong> The PO Number that was entered either does not have any traceable items attached to it, or is not a valid PO Number
							 </div>
                             <input type="text" id="purchaseOrderNumber98"  name="purchaseOrderNumber98" class="form-control" style="width: 250px;" placeholder="Enter a purchase order number">
                         </div>
                         <div class="py-4 text-center px-0">
                             <button type="button" id="continueGoToPage2" href="#" class="button button--continue" onclick="stepper1.next()" disabled>Continue</button>
                         </div>
                     </div>
                     
                     <div id="step2" role="tabpanel" class="content active" aria-labelledby="stepper1trigger2">
                         <div class="form-group text-center bs-stepper-custom-width m-auto">
                                <label class="d-inline-block mb-3"  th:if="${selectedDocType == 'PO' or selectedDocType == 'PROJECT_NUMBER'}"><span th:if="${selectedDocType == 'PROJECT_NUMBER'}"> Project Number # : <span th:text="${projectNum}"></span></span> | P.O. #: <span th:text="${poNumber}"></span><span th:if="${woNumber != ''}"> | W.O. # : <span th:text="${woNumber}"></span></span>
                                </label>
                                
                               <label th:if="${selectedDocType == 'ITEM'}" >
                               <span th:text="${'Item # : '+itemNumber}"> </span>
                               </label>
                               
                                <form id="tracedropzone" name="tracedropzone" action="/processFileUpload" class="dropzone dz-clickable" enctype="multipart/form-data" method="POST">
                                    <div>	
			       						<input type="hidden" id="purchaseOrderNumber"   name="purchaseOrderNumber" th:value="${purchaseOrderNumber}">
			       						
			       						<!-- CS 5-14-2020 -->
			       						<input type="hidden" id="itemNumber"   name="itemNumber"  th:value="${itemNumber}">
			       						<input type="hidden" id="selectedContractorType"   name="selectedContractorType"  th:value="${CONTRACTOR_ID}">
			       						
		       						</div>
		       						<div class="dz-default dz-message">
		       							<span>Files must be less than 15MB and a '.pdf' file</span>
		       						</div>
		  						</form>
	 					 </div>
                         <div class="py-4 text-center px-0 d-flex justify-content-between d-sm-block">
                             <button type="button" id="previousGoToPage1" class="button button--previous" onclick="">Previous</button>
   
                             <!-- C.Sparks 2-19-2020 New processing, bath can stay initially for testing -->
                             <button type="button" id="continueGoToPage3_NEW" class="button button--continue ml-3" onclick="" disabled>Continue</button>           
                                          
                         </div>
                     </div>
                     

 					 <div id="step3" role="tabpanel" class="content" aria-labelledby="stepper1trigger3">
                         <div class="form-group text-center">
                             <label class="d-inline-block mb-3">P.O. #: 29348 | W.O. # : W04938</label>
                             <div class="alert alert-dismissible fade hidden de-alert de-alert-urgent de-alert-impact fixed-top text-left align-items-center" role="alert">
                                 <span>3 of 11 files did not load correctly. Missing fields are displayed in red. <strong>Please correct missing fields.</strong></span>
                                 <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                             </div>
                             <table id="tableData" class="display w-100 bg-white border border-top-0 table-confirm"></table>
                         </div>
                         <div class="py-4 text-center px-0 d-flex justify-content-between d-sm-block">
                             <button type="button" class="button button--previous" onclick="stepper1.previous();">Previous</button>
                             <button type="button" class="button button--submit ml-3" id="confirmUnparsed" disabled>Submit</button>                                                       
                         </div>
                     </div>
                     
                     <div id="step4" role="tabpanel" class="content" aria-labelledby="stepper1trigger4">
                         <div class="form-group text-center bs-stepper-custom-width m-auto d-flex flex-column">
                             <div class="alert alert-dismissible fade hidden de-alert de-alert-success de-alert-impact fixed-top text-left align-items-center d-none" role="alert">
                                 <span><strong>Congrats!</strong> You have successfully corrected unparsed documents. <a href="#" data-dismiss="alert" class="button button--text" onclick="stepper1.reset();" >Upload more documents</a></span> 
                                 <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                     <span aria-hidden="true">&times;</span>
                                 </button>
                             </div>
                             <label class="d-inline-block mb-3">P.O. #: 29348 | W.O. # : W04938</label>
                          	 <i class="far fa-check-circle text-success" style="font-size:7rem;"></i>
                         	 <span class="de-h4">Congratulations!</span> <span>You have successfully corrected unparsed documents.</span>
                         </div>
                         <div class="py-4 text-center px-0 d-flex justify-content-center">
                             <button type="button" class="button button--submit ml-3" id="startOver">Start Over</button>
                         </div>
                     </div> 
     
                     
                 </div>
             </div>

         </div>
     </section>

	</body>
  
</html>