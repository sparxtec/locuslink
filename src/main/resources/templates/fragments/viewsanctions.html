<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
 <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sanction Codes</title>
<style>
table.dataTable thead th {
  font-size: 1.2rem;
 }
</style>
 <script type="text/javascript">

    var editor;
 	var secRole;
 	/*$(document).ajaxSend(function(e, xhr, options) {
 	    // Retrieve token
		var token = $("meta[name='_csrf']").attr("content");
	    var header = $("meta[name='_csrf_header']").attr("content");
		
	    console.log("Get token from veiw sanctions 1: ", token, header);
 	    xhr.setRequestHeader(header, token);
 	});*/
 	
	$(document).ready(function() {
		
		setupAjaxSend();
		
		// Retrieve token
		//var token = $("meta[name='_csrf']").attr("content");
	    //var header = $("meta[name='_csrf_header']").attr("content");
		
	    //console.log("Get token from veiw sanctions 2: ", token, header);

		editor = new $.fn.dataTable.Editor( {
			ajax: {
	      		url: 'editAdminSanctionCode',
	      		type: 'POST',
	      		headers: {
		    	      'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		    	   },
	       		contentType: 'application/json',
	       		data: function ( data ) {
	       			showSpinner();
	       			var myData = {version:"1.0", clientId:"gim"};
	       			var innerData = {};
	       			innerData = data;
	       			myData["data"] = innerData;
	           		return JSON.stringify( myData );
	 	        },
	  	        "dataSrc": function (json) {
	  	        	sanctionList = json.data.sanctionList;
		        	secRole = json.data.secRole;
	  	        	hideSpinner();
	  	        	return sanctionList;
	  	         },
	  	       	"success" : reloadDataTable
	     		},
	        table: "#sanctionsTable",
	        idSrc: 'medRefPk',
	        fields: [ {
	                label: "Sanction Code",
	                name: "medRefPk.lookupId"
	            }, {
	                label: "Type Name",
	                name: "medRefPk.lookupTypeNm"
	            }, {
	                label: "Description:",
	                name: "lookupResult"
	            }
	        ]
	    } );


	var sanctionsTable = $('#sanctionsTable').DataTable( {

	 	searchHighlight: true,
		"ordering": false,
		searching: true,
		//dom: "lrtip",
 	    ajax: {
      		url: 'getSanctionList',
      		type: 'POST',
       		contentType: 'application/json',
       		data: function ( data ) {
       			showSpinner();
       			var myData = {version:"1.0", clientId:"gim"};
       			var innerData = {};
       			myData["data"] = innerData;
           		return JSON.stringify( myData );
 	        },
  	        "dataSrc": function (json) {
  	        	sanctionList = json.data.sanctionList;
	        	secRole = json.data.secRole;
  	        	hideSpinner();
  	        	return sanctionList;
  	         }
     		},
     		"columnDefs": [
                {
                 //   "targets": [0, 1 ],
                  //  "orderable": false
                    //"searchable": false,
                    //"orderable": false
                },
            ],
	        "columns": [
	            { data: "medRefPk.lookupTypeNm" },
	            { data: "lookupResult" },

	            { "data": "", "render": function(data, type, row){
	            	//console.log ("secRole 7 ->: " + secRole);
		            	if(secRole == "MED-ADMIN" ){
		            	    return '<i class="fas fa-pencil-alt"  value="AdminEdit" />';
	            	} else {
	            		   return '<i class="fasxxx faxx-pencil-alt"/>';
	            	}
	              }
            	}

	        ],
	        // row selected by first cell
	        select: {
	            style:    'os',
	            selector: 'td:first-child'
	        },

	    });

	    $('#sanctionsTable tbody').on( 'click', 'i[value="AdminEdit"]', function () {
	    	//console.log ('yo');
	        editor.inline( sanctionsTable.cells(this.parentNode, '*').nodes(), {
	            submitTrigger: -1,
	            submitHtml: '<i class="fa fa-play"/>',
	            submit:'all'
	        } );

		 });

		function reloadDataTable(){
			//console.log("inline edit success");
			sanctionsTable.ajax.reload();
		}

	});
</script>
</head>

<body bgcolor="white">

	<!-- Sparks 4-7-2022 added this for the form margins -->
	<div  style="margin:20px">
	<div class="nav-card-body">
	   	<h3 class="nav-card-body__title" style="text-align:center"><span>Sanction Codes</span></h3>
	</div>

	<form id="SN01">
	<br>

	<table id="sanctionsTable" class="display" style="width:100%">
	   <thead >
	      <tr>
	         <th scope="col">Sanction Code</th>
	         <th scope="col">Description</th>
	         <th scope="col">Action</th>
	      </tr>
	   </thead>
	</table>



</form>
</div>
</body>
</html>
