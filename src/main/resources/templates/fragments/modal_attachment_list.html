<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
 <head>

<script>	

	$(document).ready(function() {					
		        
		hideSpinner();	
	   	$("#modal_barcode_viewer").modal('show');	
	   	       
		if( $('#attachmentDataTable').length){    
			
 			var table = $('#attachmentDataTable').DataTable( {
        	retrieve: true,
 	 		searchHighlight: true,
 	 		
 	 		searching:true,
 	 		
         	responsive: true,		        
         	"paging":   true,          
         	order: [2, 'asc' ],		
         	
 	    	ajax: {
       		    url: 'getAllAssetAttachments',
       		 	type: 'POST',
        		contentType: 'application/json',
        		data: function ( data ) {
        			showSpinner();            	
        			var myData = {version:"1.0", clientId:"locuslink"};
        			var innerData = {};            			
        			innerData["uniqueAssetPkId"] = $('input#uniqueAssetPkId').val()        			   
        			uniqueAssetPkId
        			
        			myData["data"] = innerData;	                  			
            		return JSON.stringify( myData );
 	        }, 
 	        
 	        "dataSrc": function (json) {
 	        	assetAttachmentlist = json.data.assetAttachmentlist;	     	        	
 	        	hideSpinner();	 	        	
 	        	//console.log(JSON.parse(assetAttachmentlist)); 	        	
 	        	return JSON.parse(assetAttachmentlist);     	        	      	        	
 	         }					       
    		},  
 
         columns: [	                	 
 			 { "className": 'details-control',
	               "orderable": false,
	               "data":      null,
	               "defaultContent": ''
 	         },	 	                       	      
 	         { title: "Details",
 	           data: null,
	               className: "controlColumns",
	               "render": function(data, type, row, meta){	            		
                	data ="<div class='action-buttons'>" 
                	+"<button id='docs_" + row.uniqueAssetPkId+ "' class='button button--text' type='button'> <i class='fas fa-file-invoice fa-lg' title='Attachment Viewer'></i></button>&nbsp;"                	                	
                	+"<button id='delete_" + row.uniqueAssetPkId+ "' class='button button--text' type='button'> <i class='far fa-trash-alt fa-lg' title='Delete'></i></button></div>";	                    
                return data;
 	         }}, 
               	         
             { data: "uniqueAssetPkId" },	               
             { data: "uniqueAssetId" },            
             { data: "manufacturerName" }, 
             { data: "filenameFullpath" },  
             { data: "docTypeDesc" },  
             
        	],
        	    		
         	dom: '<t><"datatable-pagination d-flex flex-row justify-content-center justify-content-md-between align-items-center mt-2" <"datatable-pagination-group d-none d-md-block" l><"datatable-pagination-group" p><"datatable-pagination-group d-none d-md-block" i>>',
         	             	        		            	          	
       });
 	 }
		
    	$('#addAttachmentId').click(function() {	
    		
			alert ("TODO upload new attachments");		    		    		    		
    	});   
    	
    	
    	
    	$('#backButtonId').click(function() {	
    		    		
    		//showSpinner();			
    		//submitFormAjaxHTML('initViewAssetData', $( "#dashboardFormDTO" ).serialize(), "commonResponse"); 
    		
    		// 5-19-2023
    		//    just close the modal, dont go back to server for no reason      		
    		$('.modal-backdrop').remove();    		
    		var node = document.getElementById("myworkspace_Asset_ModalBody");
    		node.parentNode.replaceChild(node.cloneNode(false), node);    		    		    		    		
    	});    	    	
  
    	
 		// SEARCH FILTER
  		$('#attachmentDataTable_filter input').keyup(function(){
 			table.search($(this).val()).draw() ;
 		}); 

 		
 		// Upload Attachment
  		//addAttachment
 		
 		
  		
    	 // Button Clicks on the Data table
  	    $('#attachmentDataTable tbody').on('click', 'button', function (e) {

	    	var url='';
	    	var whatWasClicked=$(this).attr("id").split("_")[0];
	    	var uniqueAssetPkId=$(this).attr("id").split("_")[1];
	    		 	    				
	        // set the FORM value so the controller can get it.				
			$('#uniqueAssetPkId').val(uniqueAssetPkId).val().trim();
	        	        	        
	   	 //   e.preventDefault(); // ??	    	
	    		   	    	    
			if(whatWasClicked==="docs") {
       			showSpinner();											 	   
      			// 5-17-2023
       			submitFormAjaxHTML('getAttachmentForAsset', $("#dashboardFormDTO").serialize(), "modalResponse_attachmentList");	
			
    		} else if(whatWasClicked==="delete") {
       			       			       			
    		} 
			 			
	    }); 
    	
	});
	
  	 function modalResponse_attachmentList (returnData) {	
  		hideSpinner();		  	 
  		$('#attachmentList_ModalBody').html(returnData); 	 		 		  		
  	 }  
	
	 
</script>
	</head>
	
<body>

 <input type="hidden" id="uniqueAssetPkId"  name="uniqueAssetPkId" th:value="${uniqueAssetPkId}"> 


	<div th:fragment="messageLogModal">
		
		<div th:id="modal_barcode_viewer" class="modal " tabindex="-1" role="dialog" aria-labelledby="classInfo"  data-keyboard="false" data-backdrop="static">
		  
		  <div class="modal-dialog modal-xl" >
		    
		    <div class="modal-content ">
		      
		      <div class="modal-header ">      
			      <h1 class="modal-title w-100 text-center"><strong>Asset Attachments</strong></h1>
			      <button type="button" id="backButtonId" class="button button--continue ml-3" data-dismiss="modal" >Back</button>			       			        
		      </div>
		      
		      
		      <div class="modal-body " >      

		        <div class="form-group text-center">
					<div class="card">
			
						<div class="card-header"><i class="fas fa-user mr-2"></i> Asset Attachments:</div>				
			
						<div class="de-component__container">				
			                    
							 <div class="datatable-toolbar border border-bottom-0 text-secondary d-flex justify-content-between align-items-center py-2 px-3">						 	
							 	<div class="datatable-toolbar-group">
							 		<div id="addbtn">
							 			<button id="addAttachmentId" class="button button--secondary-reversed w-auto"   type="button" data-toggle="modal" data-target="#addUserModal" > Add </button>
							 		</div> 
							 	</div>
							 
							 	<div class="datatable-toolbar-group">
							 		<div id="attachmentDataTable_filter" class="dataTables_filter">
							 			<label class="d-flex align-items-center">Search: <input type="search" class="form-control w-auto" placeholder="" aria-controls="attachmentDataTable"></label>
							 		</div>
							 	</div>
							 </div>	                     
			                  
			                 <div id="xxxx">		                     
			  	 					<table id="attachmentDataTable" class="bg-white border border-top-0" style="width:100%"> 	            	              		 	              		 
			                          <thead class="thead-light">
			                             <tr>
			     							<th scope="col"></th>       
			     							<th scope="col"></th>   
			                                <th scope="col">Id</th>	                                 	                          	                                 
			                                <th scope="col">Unique Asset ID</th>	                            
			                                <th scope="col">Manufacturer</th>
			                                <th scope="col">Attachment</th>
			                                <th scope="col">Doc Type</th>                                                                     	                             	                             
			                             </tr>
			                          </thead>
			                       </table>
			                 </div>		                                                       
						</div> 	
																			                                                          
					</div>				
		         </div>		          		        
		      </div>
		      
		      
		      <div class="modal-footer">
		      </div>
		      
		      
		    </div>
		  </div>
		</div> 
	</div>  
	
	
	
	<div id="attachmentList_ModalBody">	
	</div>	

</body>
</html>