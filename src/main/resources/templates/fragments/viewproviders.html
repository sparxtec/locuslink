<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>


  <script type="text/javascript">

	$(document).ready(function() {

		//  var secRole='nope';

		  var providersTable = $('#providersTable').DataTable( {

          	//retrieve: true,
 	 		searchHighlight: true,
         	//responsive: true,
         	//"paging":   true,
         	//scrollCollapse: true,
         	//scrollY: 'calc(100vh - 35rem)',
         	//order: [1, 'asc' ],
     		//colReorder: true,


		   //   "ajax": "data/objects.txt",
			//	dom: "Bfrtip",
				searching: true,
     	    	ajax: {
           		    url: 'getSearchProviderList',
           		 	type: 'POST',
            		contentType: 'application/json',
                    dataType: "json",

            		data: function ( data ) {
            			showSpinner();

            			var myData = {version:"1.0", clientId:"gim"};
            			var innerData = {};
            			myData["data"] = innerData;
                		return JSON.stringify( myData );
     	        },

     	        "dataSrc": function (json) {
     	        	console.log(json);
     	        	providerList = json.data.providerList;
     	        	secRole = json.data.userRole;
     	        	hideSpinner();
     	        	return providerList;
     	         }
        		},
        		"columnDefs": [
                    {
                       // "targets": [ 1, 3, 4, 7, 8, 9, 10, 11 ],
                        "targets": [ 11 ],
                        "orderable": false
                        //"visible": false,
                        //"searchable": false
                    },
                ],
		        "columns": [
		            { "data": "medRecId" },
		            { "data": "providerType" },
		            { "data": "providerName" },
		            { "data": "", "render": function(data, type, row){
		            	if(row.providerType == "Individual"){
		            		//return row.ssn;

		            		return row.maskedSsn;

		            	}else{
		            		//return row.einId;
		            		return row.maskedEinId;
		            	}
		            	}
		            },
		            { "data": "birthDate" },
		            { "data": "city" },
		            { "data": "state" },
		            { "data": "zipCode" },
		            { "data": "npiId" },
		            { "data": "waiverFlag" },
		            { "data": "snctCnt" },

		            { "data": "", "render": function(data, type, row){
		            	//console.log ("secRole ->: " + secRole);
 		            	if(secRole == "MED-ADMIN" || secRole == "MED-POWERUSER"){
 		            	    return '<div style="white-space:nowrap"> <input id="btnBrowse_' + row.medRecId +'" type="button" value="Browse" /> <input id="btnEdit_' + row.medRecId +'" type="button" value="Edit" /></div>';
		            	} else {
		            	     return '<input id="btnBrowse_' + row.medRecId +'" type="button" value="Browse" /> ';
		            	}
		              }
	            	}
		        ]

		   });


		 // browse each record in datatable
	     $('#providersTable tbody').on( 'click', 'input[value="Browse"]', function () {
	        var data = providersTable.row( $(this).parents('tr') ).data();
	        //console.log("med id" + data.medRecId);
	        showSpinner();
	        submitFormAjaxHTML('browseProvider', data, "initCommonResponse");
	     });

		// TODO: browse each record in datatable
	     $('#providersTable tbody').on( 'click', 'input[value="Edit"]', function () {
	        var data = providersTable.row( $(this).parents('tr') ).data();
	        //alert("TODO");
	        showSpinner();
	        submitFormAjaxHTML('editProvider', data, "initCommonResponse");
	     });


		//  HEADER
		$('#btnBack').click(function() {
			showSpinner();
			//submitFormHTML('viewProviders', 'providerFormDTO')
			submitFormAjaxHTML('initProvider', 'dashboardFormDTO', "initCommonResponse");
		});
	});



	</script>

</head>


<body bgcolor="white">

<!-- Sparks 4-7-2022 added this for the form margins -->
<div  style="margin:20px">
<div class="nav-card-body">
   	<h3 class="nav-card-body__title" style="text-align:center"><span>Provider List</span></h3>
</div>

<form id="P002"  th:objects="${dashboardFormDTO}">

   <table id="providersTable" class="display" style="width:100%">
      <thead >
         <tr>
            <th scope="col">Med Id</th>
            <th scope="col">Provider Type</th>
            <th scope="col">Business/Last Name</th>
            <th scope="col">EIN/SSN</th>
            <th scope="col">Date of Birth</th>
            <th scope="col">City</th>
            <th scope="col">State</th>
            <th scope="col">Zip</th>
            <th scope="col">NPI</th>
            <th scope="col">Curr Waivers</th>
            <th scope="col">Eff Sanctions</th>
            <th>Action</th>
         </tr>
      </thead>
   </table>


  <br>
  <br>
  <input id="btnBack"  type="button" value="Back"/>


</form>
</div>
</body>
</html>
